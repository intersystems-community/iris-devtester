{
  "contract_id": "volume-mounting",
  "feature": "010-fix-critical-bugs",
  "description": "Volume mounts from ContainerConfig are applied to containers",
  "requirements": ["FR-010", "FR-011", "FR-012", "FR-013", "FR-014"],
  "test_scenarios": [
    {
      "name": "single_volume_mount_read_write",
      "description": "Single read-write volume mount is applied to container",
      "given": {
        "config": {
          "volumes": ["./test-data:/external"]
        }
      },
      "when": "Container is created and started",
      "then": {
        "container_mounts": [
          {
            "destination": "/external",
            "mode": "rw",
            "source_exists": true
          }
        ]
      }
    },
    {
      "name": "single_volume_mount_read_only",
      "description": "Read-only volume mount respects mode flag",
      "given": {
        "config": {
          "volumes": ["./test-config:/opt/config:ro"]
        }
      },
      "when": "Container is created and started",
      "then": {
        "container_mounts": [
          {
            "destination": "/opt/config",
            "mode": "ro",
            "source_exists": true
          }
        ]
      }
    },
    {
      "name": "multiple_volume_mounts",
      "description": "Multiple volume mounts are all applied",
      "given": {
        "config": {
          "volumes": [
            "./data:/external",
            "./config:/opt/config:ro",
            "./logs:/var/log/iris:rw"
          ]
        }
      },
      "when": "Container is created and started",
      "then": {
        "container_mounts_count": 3,
        "all_destinations_present": [
          "/external",
          "/opt/config",
          "/var/log/iris"
        ]
      }
    },
    {
      "name": "volume_mount_validation_invalid_path",
      "description": "Invalid host path is detected before container creation",
      "given": {
        "config": {
          "volumes": ["/nonexistent/path:/external"]
        }
      },
      "when": "Container creation is attempted",
      "then": {
        "raises": "ValueError",
        "message_contains": [
          "Invalid volume path",
          "What went wrong:",
          "How to fix it:"
        ]
      }
    },
    {
      "name": "volume_mount_verification",
      "description": "Volume mounts are verified after container starts",
      "given": {
        "config": {
          "volumes": ["./test-data:/external"]
        }
      },
      "when": "Container is started",
      "then": {
        "verification_method": "docker_inspect",
        "attrs_path": "Mounts",
        "mount_exists": {
          "Destination": "/external",
          "Type": "bind"
        }
      }
    },
    {
      "name": "empty_volumes_list",
      "description": "Empty volumes list doesn't cause errors",
      "given": {
        "config": {
          "volumes": []
        }
      },
      "when": "Container is created and started",
      "then": {
        "container_starts": true,
        "no_extra_mounts": true
      }
    }
  ],
  "validation_method": "integration_test",
  "test_file": "tests/integration/test_volume_mounting.py",
  "success_criteria": [
    "All 6 test scenarios pass",
    "Volume mounts visible in docker inspect",
    "Files are accessible from inside container",
    "Invalid paths fail with clear error messages"
  ]
}
